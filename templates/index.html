<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Da Vinci Sniper Bot - Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0f1419;
            color: #e4e6eb;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        
        /* Sidebar */
        .sidebar {
            width: 280px;
            background: #181c25;
            border-right: 1px solid #2d3139;
            display: flex;
            flex-direction: column;
            padding: 20px;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 30px;
            text-align: center;
            padding: 15px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #8d8f94;
            font-size: 13px;
            font-weight: 600;
        }
        
        input, select {
            width: 100%;
            padding: 10px;
            background: #0f1419;
            border: 1px solid #2d3139;
            border-radius: 8px;
            color: #e4e6eb;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
            background: #181c25;
        }
        
        button {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 10px;
        }
        
        .btn-save {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-start {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }
        
        .btn-start:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(56, 239, 125, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(245, 87, 108, 0.4);
        }
        
        .demo-warning {
            padding: 12px;
            border-radius: 8px;
            font-size: 12px;
            text-align: center;
            background: rgba(249, 181, 58, 0.2);
            border: 1px solid #f9b53a;
            color: #f9b53a;
            margin-bottom: 15px;
        }
        
        .demo-balance {
            padding: 15px;
            border-radius: 8px;
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid #667eea;
            text-align: center;
            margin-top: 10px;
        }
        
        .demo-balance-label {
            font-size: 11px;
            color: #8d8f94;
            margin-bottom: 5px;
        }
        
        .demo-balance-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }
        
        .status-badge {
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            text-align: center;
            margin-top: 10px;
        }
        
        .status.running {
            background: rgba(56, 239, 125, 0.2);
            color: #38ef7d;
        }
        
        .status.stopped {
            background: rgba(245, 87, 108, 0.2);
            color: #f5576c;
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .header {
            background: #181c25;
            padding: 20px 30px;
            border-bottom: 1px solid #2d3139;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .price-box {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .price {
            font-size: 28px;
            font-weight: bold;
            color: #38ef7d;
        }
        
        .price-change {
            font-size: 14px;
            color: #8d8f94;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            background: #181c25;
            padding: 10px 30px;
            border-bottom: 1px solid #2d3139;
        }
        
        .tab {
            padding: 10px 20px;
            background: transparent;
            border: 1px solid transparent;
            color: #8d8f94;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: rgba(102, 126, 234, 0.2);
            color: #667eea;
            border-color: #667eea;
        }
        
        .tab-content {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
        }
        
        #chart-container {
            padding: 0;
            background: #0f1419;
        }
        
        #priceChart {
            width: 100%;
            height: 500px;
        }
        
        .operations-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .operation-card {
            background: #181c25;
            border: 1px solid #2d3139;
            border-radius: 12px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }
        
        .operation-card:hover {
            border-color: #667eea;
            transform: translateX(5px);
        }
        
        .operation-info {
            flex: 1;
        }
        
        .operation-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .operation-details {
            font-size: 13px;
            color: #8d8f94;
        }
        
        .operation-pnl {
            font-size: 20px;
            font-weight: bold;
        }
        
        .pnl-positive {
            color: #38ef7d;
        }

        .pnl-negative {
            color: #f5576c;
        }

        .pnl-display {
            font-size: 18px;
            font-weight: bold;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #8d8f94;
        }
        
        .empty-state svg {
            width: 100px;
            height: 100px;
            margin-bottom: 20px;
            opacity: 0.3;
        }
        
        /* Logs Container */
        .logs-container {
            height: 200px;
            background: #0f1419;
            border-top: 1px solid #2d3139;
            padding: 15px 30px;
            overflow-y: auto;
            font-size: 12px;
            font-family: 'Courier New', monospace;
        }
        
        .log-entry {
            padding: 5px 0;
            color: #8d8f94;
            border-bottom: 1px solid #181c25;
        }
        
        .log-entry.info { color: #667eea; }
        .log-entry.success { color: #38ef7d; }
        .log-entry.error { color: #f5576c; }
        .log-entry.warning { color: #f9b53a; }
        .log-entry.entry-long { 
            color: #38ef7d; 
            font-weight: bold;
            background: rgba(56, 239, 125, 0.1);
            border-left: 3px solid #38ef7d;
            padding-left: 10px;
        }
        .log-entry.entry-short { 
            color: #f5576c; 
            font-weight: bold;
            background: rgba(245, 87, 108, 0.1);
            border-left: 3px solid #f5576c;
            padding-left: 10px;
        }
        
        .alert {
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            display: none;
            font-size: 14px;
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            min-width: 300px;
        }
        
        .alert.success {
            background: rgba(56, 239, 125, 0.2);
            color: #38ef7d;
            border: 1px solid #38ef7d;
        }
        
        .alert.error {
            background: rgba(245, 87, 108, 0.2);
            color: #f5576c;
            border: 1px solid #f5576c;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
        }
        
        .modal-content {
            background: #181c25;
            margin: 5% auto;
            padding: 0;
            border: 1px solid #2d3139;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
        }
        
        .modal-header {
            padding: 20px 30px;
            border-bottom: 1px solid #2d3139;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            margin: 0;
            color: #e4e6eb;
        }
        
        .close {
            color: #8d8f94;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: #f5576c;
        }
        
        .modal-body {
            padding: 30px;
        }
        
        .modal-body .form-group {
            margin-bottom: 20px;
        }
        
        .modal-body small {
            display: block;
            color: #8d8f94;
            font-size: 11px;
            margin-top: 5px;
        }
        
        /* Active Filters */
        .filter-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            background: rgba(102, 126, 234, 0.2);
            border: 1px solid #667eea;
            color: #667eea;
        }
        
        .filter-badge.required {
            background: rgba(56, 239, 125, 0.2);
            border-color: #38ef7d;
            color: #38ef7d;
        }
        
        .filter-badge.optional {
            background: rgba(249, 181, 58, 0.2);
            border-color: #f9b53a;
            color: #f9b53a;
        }

        /* Config Tabs Styles */
        .config-tab {
            position: relative;
            transition: all 0.3s ease;
        }

        .config-tab:hover {
            background: rgba(102, 126, 234, 0.1);
        }

        .config-tab.active {
            background: rgba(102, 126, 234, 0.1);
        }

        .config-tab.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            right: 0;
            height: 2px;
            background: #667eea;
        }

        /* Animation for tab switching */
        .config-tab-content {
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Help Button Styles */
        button[onclick="openHelpModal()"]:hover {
            background: rgba(102, 126, 234, 0.2) !important;
            color: #667eea !important;
            transform: scale(1.1);
        }

        /* Help Modal Styles */
        .help-content {
            max-height: 70vh;
            overflow-y: auto;
            padding-right: 10px;
        }

        .help-content::-webkit-scrollbar {
            width: 8px;
        }

        .help-content::-webkit-scrollbar-track {
            background: #2d3139;
            border-radius: 4px;
        }

        .help-content::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 4px;
        }

        .help-content::-webkit-scrollbar-thumb:hover {
            background: #764ba2;
        }

        .help-section {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(102, 126, 234, 0.05);
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .help-section h3 {
            color: #667eea;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .help-section h4 {
            color: #f9b53a;
            margin-top: 15px;
            margin-bottom: 10px;
        }

        .help-section ul {
            margin-left: 20px;
            color: #e4e6eb;
            line-height: 1.6;
        }

        .help-section li {
            margin-bottom: 8px;
        }

        .help-code {
            background: #2d3139;
            padding: 8px 12px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #38ef7d;
            margin: 8px 0;
        }

        .help-warning {
            background: rgba(249, 181, 58, 0.1);
            border: 1px solid #f9b53a;
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
            color: #f9b53a;
        }

        .help-tip {
            background: rgba(56, 239, 125, 0.1);
            border: 1px solid #38ef7d;
            padding: 12px;
            border-radius: 8px;
            margin: 15px 0;
            color: #38ef7d;
        }

        /* Sidebar Redesign */
        .sidebar-section {
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(24, 28, 37, 0.6);
            border-radius: 10px;
            border: 1px solid #2d3139;
        }

        .sidebar-section-title {
            font-size: 11px;
            font-weight: 600;
            color: #8d8f94;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .status-section {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1), rgba(118, 75, 162, 0.1));
            border: 1px solid #667eea;
        }

        .config-section {
            background: rgba(15, 20, 25, 0.8);
        }

        .action-section {
            background: rgba(56, 239, 125, 0.05);
            border: 1px solid #38ef7d;
        }

        .info-section {
            background: rgba(24, 28, 37, 0.4);
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }

        .status-indicator.running {
            background: rgba(56, 239, 125, 0.2);
            color: #38ef7d;
            border: 1px solid #38ef7d;
        }

        .status-indicator.stopped {
            background: rgba(245, 87, 108, 0.2);
            color: #f5576c;
            border: 1px solid #f5576c;
        }

        .status-indicator::before {
            content: '';
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .price-display {
            font-size: 18px;
            font-weight: bold;
            color: #38ef7d;
            margin: 8px 0;
        }

        .price-change {
            font-size: 11px;
            color: #8d8f94;
        }

        .pnl-display {
            font-size: 14px;
            font-weight: bold;
            padding: 6px 10px;
            border-radius: 6px;
            text-align: center;
        }

        .pnl-display.positive {
            background: rgba(56, 239, 125, 0.2);
            color: #38ef7d;
        }

        .pnl-display.negative {
            background: rgba(245, 87, 108, 0.2);
            color: #f5576c;
        }

        .compact-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .compact-controls .form-group {
            margin-bottom: 10px;
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .action-buttons button {
            flex: 1;
            padding: 10px;
            font-size: 13px;
        }

        .demo-balance-compact {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid #667eea;
            padding: 10px;
            border-radius: 6px;
            text-align: center;
            margin-bottom: 10px;
        }

        .demo-balance-label {
            font-size: 10px;
            color: #8d8f94;
            margin-bottom: 4px;
        }

        .demo-balance-value {
            font-size: 16px;
            font-weight: bold;
            color: #667eea;
        }

        .sound-controls-compact {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: rgba(15, 20, 25, 0.6);
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #2d3139;
        }

        .sound-toggle-compact {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .volume-slider-compact {
            flex: 1;
            height: 4px;
            background: #2d3139;
            border-radius: 2px;
            cursor: pointer;
            margin: 0 10px;
        }

        .mini-tools {
            display: flex;
            gap: 5px;
        }

        .mini-tools button {
            width: 28px;
            height: 28px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            background: transparent;
            border: 1px solid #2d3139;
            border-radius: 6px;
            color: #8d8f94;
            transition: all 0.3s;
        }

        .mini-tools button:hover {
            background: rgba(102, 126, 234, 0.1);
            border-color: #667eea;
            color: #667eea;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <!-- Header -->
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
            <div class="logo">ü§ñ Da Vinci Bot</div>
            <button onclick="openHelpModal()" style="background: transparent; border: none; color: #8d8f94; cursor: pointer; font-size: 18px; padding: 5px; border-radius: 6px; transition: all 0.3s; display: flex; align-items: center; justify-content: center; width: 32px; height: 32px;" title="Help & Documentation">
                ‚ùì
            </button>
        </div>

        <!-- Status Section -->
        <div class="sidebar-section status-section">
            <div class="sidebar-section-title">
                <span>üìä</span>
                <span>STATUS</span>
            </div>
            <div style="text-align: center; margin-bottom: 12px;">
                <div id="sidebarStatus" class="status-indicator stopped">‚óè Bot Stopped</div>
            </div>
            <div style="margin-bottom: 8px;">
                <div style="font-size: 11px; color: #8d8f94; margin-bottom: 2px;">Ativo</div>
                <div style="font-size: 13px; font-weight: 600; color: #e4e6eb;" id="sidebarSymbol">BTC/USDT</div>
            </div>
            <div style="margin-bottom: 8px;">
                <div style="font-size: 11px; color: #8d8f94; margin-bottom: 2px;">Timeframe</div>
                <div style="font-size: 13px; font-weight: 600; color: #e4e6eb;" id="sidebarTimeframe">5m</div>
            </div>
            <div style="margin-bottom: 12px;">
                <div class="price-display" id="sidebarPrice">$0.00</div>
                <div class="price-change" id="sidebarPriceChange">-</div>
            </div>
            <div id="sidebarPnlContainer" style="margin-bottom: 8px;">
                <div style="font-size: 11px; color: #8d8f94; margin-bottom: 4px;">PnL do Dia</div>
                <div id="sidebarPnl" class="pnl-display">$0.00</div>
            </div>
        </div>

        <!-- Configuration Section -->
        <div class="sidebar-section config-section">
            <div class="sidebar-section-title">
                <span>‚öôÔ∏è</span>
                <span>CONFIGURA√á√ïES</span>
            </div>
            <div class="form-group">
                <label>Operation Mode</label>
                <select id="useDemo">
                    <option value="true">üéÆ Demo (Fake Balance)</option>
                    <option value="false">üí∞ Real (Binance)</option>
                </select>
            </div>
            <div class="compact-controls">
                <div class="form-group">
                    <label>Pair</label>
                    <select id="symbol">
                        <option value="BTC/USDT">BTC/USDT</option>
                        <option value="ETH/USDT">ETH/USDT</option>
                        <option value="SOL/USDT">SOL/USDT</option>
                        <option value="BNB/USDT">BNB/USDT</option>
                        <option value="ADA/USDT">ADA/USDT</option>
                        <option value="AVAX/USDT">AVAX/USDT</option>
                        <option value="DOT/USDT">DOT/USDT</option>
                        <option value="MATIC/USDT">MATIC/USDT</option>
                        <option value="LINK/USDT">LINK/USDT</option>
                        <option value="UNI/USDT">UNI/USDT</option>
                        <option value="AAVE/USDT">AAVE/USDT</option>
                        <option value="XRP/USDT">XRP/USDT</option>
                        <option value="DOGE/USDT">DOGE/USDT</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Timeframe</label>
                    <select id="timeframe">
                        <option value="1m">1m</option>
                        <option value="3m">3m</option>
                        <option value="5m">5m</option>
                        <option value="15m">15m</option>
                        <option value="30m">30m</option>
                        <option value="1h">1h</option>
                    </select>
                </div>
            </div>
            <div class="compact-controls">
                <div class="form-group">
                    <label>Amount</label>
                    <input type="number" id="positionSize" min="10" max="10000" step="10">
                </div>
                <div class="form-group">
                    <label>Leverage</label>
                    <select id="leverage">
                        <option value="1">1x</option>
                        <option value="3">3x</option>
                        <option value="5">5x</option>
                        <option value="10">10x</option>
                        <option value="20">20x</option>
                        <option value="25">25x</option>
                    </select>
                </div>
            </div>
            <button class="btn-save" onclick="openConfigModal()" style="width: 100%; margin-top: 10px; font-size: 13px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                ‚öôÔ∏è Config Avan√ßada
            </button>
        </div>

        <!-- Action Section -->
        <div class="sidebar-section action-section">
            <div class="sidebar-section-title">
                <span>üéØ</span>
                <span>A√á√ïES</span>
            </div>
            <div class="action-buttons" style="margin-bottom: 10px;">
                <button class="btn-start" onclick="startBot()">‚ñ∂Ô∏è Start</button>
                <button class="btn-danger" onclick="stopBot()" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">‚èπÔ∏è Stop</button>
            </div>
            <button class="btn-save" onclick="saveConfig()">üíæ Save Config</button>
        </div>

        <!-- Info Section -->
        <div class="sidebar-section info-section">
            <div class="sidebar-section-title">
                <span>üí∞</span>
                <span>INFORMA√á√ïES</span>
            </div>

            <!-- Demo Balance (se aplic√°vel) -->
            <div id="demoBalanceContainer" style="display: none;">
                <div class="demo-balance-compact">
                    <div class="demo-balance-label">Demo Balance</div>
                    <div class="demo-balance-value" id="demoBalance">$1,000.00</div>
                </div>
                <button class="btn-danger" onclick="resetDemo()" style="width: 100%; padding: 6px 10px; margin-bottom: 10px; font-size: 11px;">üîÑ Reset Balance</button>
            </div>

            <!-- Demo Warning -->
            <div id="demoWarning" class="demo-warning" style="display: none; margin-bottom: 10px; font-size: 11px; padding: 8px;">
                ‚ö†Ô∏è DEMO MODE ACTIVE - No financial risk
            </div>

            <!-- Sound Controls -->
            <div class="sound-controls-compact">
                <div class="sound-toggle-compact">
                    <span style="font-size: 12px; color: #8d8f94;">üîî</span>
                    <label style="position: relative; display: inline-block; width: 32px; height: 18px;">
                        <input type="checkbox" id="soundEnabled" checked style="opacity: 0; width: 0; height: 0;">
                        <span style="position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #667eea; transition: .4s; border-radius: 18px;">
                            <span style="position: absolute; content: ''; height: 14px; width: 14px; left: 2px; bottom: 2px; background-color: white; transition: .4s; border-radius: 50%;"></span>
                        </span>
                    </label>
                </div>
                <div class="volume-slider-compact" id="volumeControlCompact"></div>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="header">
            <div style="flex: 1;">
                <h2 id="currentSymbol">BTC/USDT</h2>
                <div class="price-box">
                    <span class="price" id="currentPrice">$0.00</span>
                    <span class="price-change" id="priceChange">-</span>
                </div>
                <div class="active-filters" id="activeFilters" style="margin-top: 10px; display: flex; gap: 8px; flex-wrap: wrap;">
                    <!-- Filtros ativos ser√£o mostrados aqui -->
                </div>
            </div>
            <div style="text-align: center; flex: 1; display: flex; flex-direction: column; justify-content: center; min-width: 250px;">
                <div class="pnl-container">
                    <div style="font-size: 14px; color: #8d8f94; margin-bottom: 4px; font-weight: 600;">PnL do Dia</div>
                    <div class="pnl-display" id="pnlDisplay" style="font-size: 28px;">$0.00</div>
                    <div class="pnl-stats" id="pnlStats" style="font-size: 12px; color: #8d8f94; margin-top: 4px; font-weight: 500;">
                        <span id="pnlOps">0 ops</span> | <span id="pnlWinRate">0%</span> | <span id="pnlStatus">Neutro</span>
                    </div>
                </div>
            </div>
            <div style="text-align: right; flex: 1;">
                <div id="status" class="status-badge stopped">‚óè Bot Stopped</div>
            </div>
        </div>
        
        <!-- Tabs -->
        <div class="tabs">
            <div class="tab active" onclick="switchTab('chart')">üìà Chart</div>
            <div class="tab" onclick="switchTab('open')">üìä Open</div>
            <div class="tab" onclick="switchTab('closed')">üìà Closed</div>
        </div>
        
        <!-- Tab Content -->
        <div class="tab-content">
            <!-- Gr√°fico de Candles -->
            <div id="chart-container" class="operations-list">
                <div id="priceChart" style="width: 100%; height: 500px;"></div>
            </div>
            
            <!-- Open Operations -->
            <div id="open-operations" class="operations-list" style="display:none;">
                <div class="empty-state">
                    <p>Loading operations...</p>
                </div>
            </div>

            <!-- Closed Operations -->
            <div id="closed-operations" class="operations-list" style="display:none;">
                <div class="empty-state">
                    <p>Loading operations...</p>
                </div>
            </div>
        </div>
        
        <!-- Logs -->
        <div style="display: flex; flex-direction: column; background: #181c25; border-top: 1px solid #2d3139;">
            <div style="padding: 10px 30px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #2d3139;">
                <h3 style="font-size: 14px; color: #8d8f94; margin: 0;">üìã Logs</h3>
                <button class="btn-danger" onclick="clearLogs()" style="width: auto; padding: 6px 15px; margin: 0; font-size: 12px;">üóëÔ∏è Clear Logs</button>
            </div>
            <div class="logs-container" id="logsContainer">
                <div class="log-entry info">Loading logs...</div>
            </div>
        </div>
    </div>
    
    <!-- Alert -->
    <div id="alert" class="alert"></div>
    
    <!-- Config Modal -->
    <div id="configModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚öôÔ∏è Configure Filters</h2>
                <span class="close" onclick="closeConfigModal()">&times;</span>
            </div>

            <!-- Tabs Navigation -->
            <div class="config-tabs" style="display: flex; background: #181c25; border-bottom: 1px solid #2d3139;">
                <div class="config-tab active" onclick="switchConfigTab('entry')" style="flex: 1; padding: 15px; text-align: center; cursor: pointer; color: #667eea; border-bottom: 2px solid #667eea; font-weight: 600; transition: all 0.3s;">
                    üö™ Entry Filters
                </div>
                <div class="config-tab" onclick="switchConfigTab('exit')" style="flex: 1; padding: 15px; text-align: center; cursor: pointer; color: #8d8f94; border-bottom: 2px solid transparent; font-weight: 600; transition: all 0.3s;">
                    üéØ Exit Filters
                </div>
            </div>

            <div class="modal-body">
                <!-- Entry Filters Tab -->
                <div id="entryFiltersTab" class="config-tab-content">
                    <div style="padding: 20px 0;">
                        <h3 style="color: #667eea; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                            <span>üö™ Entry Conditions</span>
                            <span style="font-size: 12px; color: #8d8f94; font-weight: normal;">Configure when to enter positions</span>
                        </h3>

                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 8px; color: #667eea; font-weight: 600;">
                                <span style="color: #38ef7d;">‚óè</span> RSI Entry Filters
                            </label>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                            <div class="form-group">
                                <label>Minimum RSI for LONG</label>
                                <input type="number" id="rsiLong" min="50" max="70" value="55">
                                <small>Enter LONG when RSI > this value</small>
                            </div>
                            <div class="form-group">
                                <label>Maximum RSI for SHORT</label>
                                <input type="number" id="rsiShort" min="30" max="50" value="40">
                                <small>Enter SHORT when RSI < this value</small>
                            </div>
                        </div>

                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 8px; color: #667eea; font-weight: 600; margin-top: 20px;">
                                <span style="color: #f9b53a;">‚óè</span> Optional Entry Filters
                            </label>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 10px;">
                                    <input type="checkbox" id="useVol" style="width: auto;">
                                    <span>Volume Filter</span>
                                </label>
                                <small style="margin-top: 5px; display: block;">Volume 15% above average</small>
                            </div>
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 10px;">
                                    <input type="checkbox" id="useAdx" style="width: auto;">
                                    <span>ADX Filter</span>
                                </label>
                                <small style="margin-top: 5px; display: block;">Trend strength requirement</small>
                            </div>
                        </div>

                        <div class="form-group" style="margin-bottom: 20px;">
                            <label>ADX Threshold</label>
                            <input type="number" id="adxThresh" min="10" max="30" value="18">
                            <small>ADX > this value indicates strong trend</small>
                        </div>

                        <div style="background: rgba(102, 126, 234, 0.1); border: 1px solid #667eea; border-radius: 8px; padding: 15px; margin-top: 20px;">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                <span style="color: #667eea; font-weight: 600;">üìä Entry Summary</span>
                            </div>
                            <div style="font-size: 12px; color: #8d8f94; line-height: 1.6;">
                                <div>‚Ä¢ <strong>Always Active:</strong> EMA 8/21 Crossover</div>
                                <div>‚Ä¢ <strong>RSI:</strong> LONG > <span id="summaryRsiLong">55</span> | SHORT < <span id="summaryRsiShort">40</span></div>
                                <div>‚Ä¢ <strong>Volume:</strong> <span id="summaryVol">Disabled</span></div>
                                <div>‚Ä¢ <strong>ADX:</strong> <span id="summaryAdx">Disabled</span> (Threshold: <span id="summaryAdxThresh">18</span>)</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Exit Filters Tab -->
                <div id="exitFiltersTab" class="config-tab-content" style="display: none;">
                    <div style="padding: 20px 0;">
                        <h3 style="color: #f5576c; margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                            <span>üéØ Exit Conditions</span>
                            <span style="font-size: 12px; color: #8d8f94; font-weight: normal;">Configure when to exit positions</span>
                        </h3>

                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 8px; color: #f5576c; font-weight: 600;">
                                <span style="color: #f5576c;">‚óè</span> Basic Exit Settings
                            </label>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                            <div class="form-group">
                                <label style="color: #f5576c; font-weight: 600;">Stop Loss (%)</label>
                                <input type="number" id="stopLoss" min="0.1" max="5" step="0.1" value="0.8">
                                <small>Maximum loss percentage</small>
                            </div>
                            <div class="form-group">
                                <label style="color: #38ef7d; font-weight: 600;">Take Profit (%)</label>
                                <input type="number" id="takeProfit" min="0.5" max="10" step="0.1" value="1.8">
                                <small>Target profit percentage</small>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 25px;">
                            <div class="form-group">
                                <label style="color: #667eea; font-weight: 600;">Trailing Stop (%)</label>
                                <input type="number" id="trailingStop" min="0.1" max="3" step="0.1" value="0.5">
                                <small>Trailing offset percentage</small>
                            </div>
                            <div class="form-group">
                                <div style="margin-top: 25px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                                    <label style="display: flex; align-items: center; gap: 8px;">
                                        <input type="checkbox" id="useFixedExit" style="width: auto;" checked>
                                        <span style="font-size: 13px;">Fixed SL/TP</span>
                                    </label>
                                    <label style="display: flex; align-items: center; gap: 8px;">
                                        <input type="checkbox" id="useTrailing" style="width: auto;" checked>
                                        <span style="font-size: 13px;">Trailing</span>
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 8px; color: #f9b53a; font-weight: 600;">
                                <span style="color: #f9b53a;">‚óè</span> Advanced Exit Filters
                            </label>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 10px;">
                                    <input type="checkbox" id="useExitRsi" style="width: auto;">
                                    <span>RSI Exit Filter</span>
                                </label>
                            </div>
                            <div class="form-group">
                                <label>RSI LONG Exit</label>
                                <input type="number" id="exitRsiLong" min="60" max="90" value="70">
                                <small>Exit LONG when RSI ‚â• this</small>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div class="form-group">
                                <label>RSI SHORT Exit</label>
                                <input type="number" id="exitRsiShort" min="10" max="40" value="30">
                                <small>Exit SHORT when RSI ‚â§ this</small>
                            </div>
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 10px;">
                                    <input type="checkbox" id="useExitAdx" style="width: auto;">
                                    <span>ADX Exit Filter</span>
                                </label>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div class="form-group">
                                <label>ADX Exit Threshold</label>
                                <input type="number" id="exitAdxThreshold" min="15" max="40" value="25">
                                <small>Exit when ADX < this (weak trend)</small>
                            </div>
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 10px;">
                                    <input type="checkbox" id="useTimeExit" style="width: auto;">
                                    <span>Time Exit</span>
                                </label>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                            <div class="form-group">
                                <label>Max Time (minutes)</label>
                                <input type="number" id="exitAfterMinutes" min="5" max="480" value="60">
                                <small>Maximum time in position</small>
                            </div>
                            <div class="form-group">
                                <label style="display: flex; align-items: center; gap: 10px;">
                                    <input type="checkbox" id="exitOnVolumeSpike" style="width: auto;" checked>
                                    <span>Volume Spike Exit</span>
                                </label>
                            </div>
                        </div>

                        <div class="form-group" style="margin-bottom: 25px;">
                            <label>Volume Spike Multiplier</label>
                            <input type="number" id="exitVolumeMultiplier" min="1.5" max="5" step="0.1" value="2.0">
                            <small>Exit when volume > average √ó this value</small>
                        </div>

                        <div style="background: rgba(245, 87, 108, 0.1); border: 1px solid #f5576c; border-radius: 8px; padding: 15px;">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                <span style="color: #f5576c; font-weight: 600;">üìä Exit Summary</span>
                            </div>
                            <div style="font-size: 12px; color: #8d8f94; line-height: 1.6;">
                                <div>‚Ä¢ <strong>Stop Loss:</strong> <span id="summaryStopLoss">0.8</span>% | <strong>Take Profit:</strong> <span id="summaryTakeProfit">1.8</span>%</div>
                                <div>‚Ä¢ <strong>Trailing:</strong> <span id="summaryTrailing">Enabled</span> (<span id="summaryTrailingValue">0.5</span>%)</div>
                                <div>‚Ä¢ <strong>RSI Exit:</strong> <span id="summaryExitRsi">Disabled</span></div>
                                <div>‚Ä¢ <strong>ADX Exit:</strong> <span id="summaryExitAdx">Disabled</span> | <strong>Time Exit:</strong> <span id="summaryTimeExit">Disabled</span></div>
                                <div>‚Ä¢ <strong>Volume Spike:</strong> <span id="summaryVolSpike">Enabled</span> (<span id="summaryVolSpikeValue">2.0</span>x)</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Save Button (visible in both tabs) -->
                <div style="border-top: 1px solid #2d3139; padding-top: 20px; margin-top: 20px;">
                    <button class="btn-save" onclick="saveFiltersConfig()" style="width: 100%;">üíæ Save All Filters</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 800px; max-height: 90vh;">
            <div class="modal-header">
                <h2>üìö Da Vinci Bot - Documentation</h2>
                <span class="close" onclick="closeHelpModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="help-content">
                    <!-- Overview Section -->
                    <div class="help-section">
                        <h3>ü§ñ Bot Overview</h3>
                        <p><strong>Da Vinci Sniper Bot</strong> is an automated cryptocurrency trading bot that uses technical analysis to identify entry and exit opportunities in the futures market.</p>

                        <div class="help-tip">
                            <strong>üí° Quick Start:</strong> Configure your filters, set risk parameters, and start the bot in DEMO mode first!
                        </div>

                        <h4>üéØ Core Strategy</h4>
                        <ul>
                            <li><strong>Entry Signal:</strong> EMA 8/21 Crossover with additional filters</li>
                            <li><strong>Risk Management:</strong> Configurable Stop Loss and Take Profit</li>
                            <li><strong>Advanced Features:</strong> Multiple exit filters for optimal timing</li>
                            <li><strong>Supported Exchanges:</strong> Binance Futures (with API integration)</li>
                        </ul>
                    </div>

                    <!-- Entry Filters Section -->
                    <div class="help-section">
                        <h3>üö™ Entry Filters</h3>
                        <p>The bot uses a combination of technical indicators to determine optimal entry points:</p>

                        <h4>RSI Entry Filters</h4>
                        <ul>
                            <li><strong>RSI LONG:</strong> Enter LONG positions when RSI > configured value (default: 55)</li>
                            <li><strong>RSI SHORT:</strong> Enter SHORT positions when RSI < configured value (default: 40)</li>
                            <li><strong>Purpose:</strong> Avoid entering during extreme overbought/oversold conditions</li>
                        </ul>

                        <div class="help-code">
                            RSI Range: 0-100 | Overbought: >70 | Oversold: <30
                        </div>

                        <h4>Optional Entry Filters</h4>
                        <ul>
                            <li><strong>Volume Filter:</strong> Requires 15% above average volume for confirmation</li>
                            <li><strong>ADX Filter:</strong> Ensures sufficient trend strength (default threshold: 18)</li>
                            <li><strong>Always Active:</strong> EMA 8/21 crossover as primary signal</li>
                        </ul>

                        <div class="help-warning">
                            ‚ö†Ô∏è <strong>Important:</strong> The EMA crossover is the primary signal. Other filters act as confirmations and can be enabled/disabled based on your strategy.
                        </div>
                    </div>

                    <!-- Exit Settings Section -->
                    <div class="help-section">
                        <h3>üéØ Exit Settings</h3>
                        <p>Multiple exit mechanisms ensure proper risk management and profit optimization:</p>

                        <h4>Basic Exit Settings</h4>
                        <ul>
                            <li><strong>Stop Loss:</strong> Maximum acceptable loss percentage (default: 0.8%)</li>
                            <li><strong>Take Profit:</strong> Target profit percentage (default: 1.8%)</li>
                            <li><strong>Trailing Stop:</strong> Dynamic stop that follows favorable price movements</li>
                            <li><strong>Fixed SL/TP:</strong> Enable/disable standard stop loss and take profit</li>
                        </ul>

                        <div class="help-code">
                            Risk/Reward Ratio: 1:2.25 (0.8% SL vs 1.8% TP)
                        </div>

                        <h4>Advanced Exit Filters</h4>
                        <ul>
                            <li><strong>RSI Exit:</strong> Exit positions when RSI reaches extreme levels</li>
                            <li><strong>ADX Exit:</strong> Exit when trend strength weakens</li>
                            <li><strong>Time Exit:</strong> Maximum duration limit for positions</li>
                            <li><strong>Volume Spike:</strong> Exit during unusual volume activity</li>
                        </ul>

                        <div class="help-tip">
                            üí° <strong>Pro Tip:</strong> Combine multiple exit filters for better timing. For example, use RSI exit for taking profits early during strong reversals.
                        </div>
                    </div>

                    <!-- Risk Management Section -->
                    <div class="help-section">
                        <h3>‚öñÔ∏è Risk Management</h3>

                        <h4>Position Sizing</h4>
                        <ul>
                            <li><strong>Position Size:</strong> Fixed USD amount per trade (configurable)</li>
                            <li><strong>Leverage:</strong> Multiplier for position size (1x-25x available)</li>
                            <li><strong>Recommended:</strong> Start with low leverage (3x-5x) in DEMO mode</li>
                        </ul>

                        <div class="help-warning">
                            ‚ö†Ô∏è <strong>Risk Warning:</strong> Higher leverage amplifies both gains AND losses. Always test extensively in DEMO mode before using real funds.
                        </div>

                        <h4>Mode Selection</h4>
                        <ul>
                            <li><strong>DEMO Mode:</strong> Paper trading with simulated balance</li>
                            <li><strong>LIVE Mode:</strong> Real trading with Binance API (requires API keys)</li>
                            <li><strong>Recommendation:</strong> Master DEMO mode first, then start with small amounts in LIVE mode</li>
                        </ul>
                    </div>

                    <!-- Technical Indicators Section -->
                    <div class="help-section">
                        <h3>üìä Technical Indicators Explained</h3>

                        <h4>EMA (Exponential Moving Average)</h4>
                        <ul>
                            <li><strong>EMA 8:</strong> Fast moving average (short-term trend)</li>
                            <li><strong>EMA 21:</strong> Slow moving average (medium-term trend)</li>
                            <li><strong>Crossover Signal:</strong> EMA 8 crossing above EMA 21 = BUY signal</li>
                            <li><strong>Crossunder Signal:</strong> EMA 8 crossing below EMA 21 = SELL signal</li>
                        </ul>

                        <h4>RSI (Relative Strength Index)</h4>
                        <ul>
                            <li><strong>Range:</strong> 0-100 oscillator measuring momentum</li>
                            <li><strong>Overbought:</strong> RSI > 70 (potential reversal down)</li>
                            <li><strong>Oversold:</strong> RSI < 30 (potential reversal up)</li>
                            <li><strong>Bot Usage:</strong> Filters for entry timing and exit signals</li>
                        </ul>

                        <h4>ADX (Average Directional Index)</h4>
                        <ul>
                            <li><strong>Purpose:</strong> Measures trend strength (not direction)</li>
                            <li><strong>Range:</strong> 0-100</li>
                            <li><strong>Strong Trend:</strong> ADX > 25</li>
                            <li><strong>Weak Trend:</strong> ADX < 20</li>
                            <li><strong>Bot Usage:</strong> Filter to avoid weak/trending markets</li>
                        </ul>
                    </div>

                    <!-- Best Practices Section -->
                    <div class="help-section">
                        <h3>‚úÖ Best Practices</h3>

                        <h4>Getting Started</h4>
                        <ol>
                            <li>Start in DEMO mode with default settings</li>
                            <li>Monitor the bot for at least 24 hours</li>
                            <li>Analyze the logs and trade results</li>
                            <li>Adjust filters based on market conditions</li>
                            <li>Gradually increase position size if profitable</li>
                        </ol>

                        <h4>Configuration Tips</h4>
                        <ul>
                            <li><strong>Conservative:</strong> Higher RSI thresholds, tighter stop losses</li>
                            <li><strong>Aggressive:</strong> Lower RSI thresholds, wider stop losses</li>
                            <li><strong>Trending Markets:</strong> Enable ADX filter, disable time exit</li>
                            <li><strong>Ranging Markets:</strong> Enable RSI exit, use tighter targets</li>
                        </ul>

                        <div class="help-tip">
                            üéØ <strong>Strategy Tip:</strong> Different market conditions require different filter combinations. Test various configurations to find what works best for current market conditions.
                        </div>

                        <h4>Common Pitfalls to Avoid</h4>
                        <ul>
                            <li>‚ùå Starting with real money without testing</li>
                            <li>‚ùå Using maximum leverage (25x) initially</li>
                            <li>‚ùå Ignoring stop losses and letting losses run</li>
                            <li>‚ùå Over-optimizing filters for past performance</li>
                            <li>‚ùå Not monitoring the bot during volatile market conditions</li>
                        </ul>
                    </div>

                    <!-- Troubleshooting Section -->
                    <div class="help-section">
                        <h3>üîß Troubleshooting</h3>

                        <h4>Common Issues</h4>
                        <ul>
                            <li><strong>Bot not taking trades:</strong> Check if filters are too restrictive</li>
                            <li><strong>API errors:</strong> Verify Binance API keys and permissions</li>
                            <li><strong>Connection issues:</strong> Check internet connection and firewall</li>
                            <li><strong>Invalid configuration:</strong> Ensure all values are within allowed ranges</li>
                        </ul>

                        <h4>Log Analysis</h4>
                        <p>Monitor these log messages:</p>
                        <ul>
                            <li><strong>*** CROSSOVER/CROSSUNDER ***</strong> - Signal detection</li>
                            <li><strong>>>> ENTRADA LONG/SHORT <<<</strong> - Trade execution</li>
                            <li><strong>[SA√çDA LONG/SHORT]</strong> - Position closure</li>
                            <li><strong>[BLOQUEADO]</strong> - Filter prevented trade</li>
                        </ul>

                        <div class="help-warning">
                            ‚ö†Ô∏è <strong>Important:</strong> Always check the logs regularly to understand bot behavior and diagnose issues quickly.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

        <script src="https://unpkg.com/lightweight-charts@4.1.1/dist/lightweight-charts.standalone.production.js"></script>
        
        <script>
        let currentLogs = [];
        let priceChart = null;
        let soundEnabled = true;
        let lastTradeCount = 0; // Contador para detectar novas opera√ß√µes

        // Sistema de Som
        let volumeLevel = 0.5; // Volume padr√£o 50%

        function playTradeSound(type) {
            if (!soundEnabled) return;

            try {
                // Usa Web Audio API para gerar som programaticamente
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                // Configura√ß√£o baseada no tipo de opera√ß√£o
                if (type === 'LONG') {
                    // Som de subida (tom otimista)
                    oscillator.frequency.setValueAtTime(440, audioContext.currentTime); // A4
                    oscillator.frequency.exponentialRampToValueAtTime(880, audioContext.currentTime + 0.1); // A5
                    oscillator.frequency.exponentialRampToValueAtTime(1320, audioContext.currentTime + 0.2); // E6
                } else if (type === 'SHORT') {
                    // Som de descida (tom cauteloso)
                    oscillator.frequency.setValueAtTime(880, audioContext.currentTime); // A5
                    oscillator.frequency.exponentialRampToValueAtTime(440, audioContext.currentTime + 0.1); // A4
                    oscillator.frequency.exponentialRampToValueAtTime(220, audioContext.currentTime + 0.2); // A3
                } else if (type === 'EXIT') {
                    // Som de sa√≠da (notifica√ß√£o r√°pida)
                    oscillator.frequency.setValueAtTime(523, audioContext.currentTime); // C5
                    oscillator.frequency.setValueAtTime(659, audioContext.currentTime + 0.05); // E5
                    oscillator.frequency.setValueAtTime(784, audioContext.currentTime + 0.1); // G5
                }

                // Volume e envelope com controle din√¢mico
                const maxVolume = 0.2; // Volume m√°ximo
                const targetVolume = maxVolume * volumeLevel;

                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(targetVolume, audioContext.currentTime + 0.01);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);

                // Reprodu√ß√£o
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + 0.3);

            } catch (error) {
                console.error('Erro ao reproduzir som:', error);
            }
        }

        function testSound() {
            playTradeSound('LONG');
            setTimeout(() => playTradeSound('SHORT'), 400);
            setTimeout(() => playTradeSound('EXIT'), 800);
        }

        // Listener para o toggle de som e volume
        document.addEventListener('DOMContentLoaded', function() {
            const soundToggle = document.getElementById('soundEnabled');
            const volumeControl = document.getElementById('volumeControl');
            const volumeValue = document.getElementById('volumeValue');

            // Volume compacto no sidebar
            const volumeCompact = document.getElementById('volumeControlCompact');

            function updateToggleUI() {
                // Para o toggle principal (no modal antigo, se existir)
                if (soundToggle && soundToggle.nextElementSibling) {
                    const toggleSpan = soundToggle.nextElementSibling;
                    const toggleButton = toggleSpan.querySelector('span');
                    if (toggleButton) {
                        if (soundToggle.checked) {
                            toggleSpan.style.backgroundColor = '#667eea';
                            toggleButton.style.transform = 'translateX(20px)';
                        } else {
                            toggleSpan.style.backgroundColor = '#2d3139';
                            toggleButton.style.transform = 'translateX(0)';
                        }
                    }
                }
                soundEnabled = soundToggle.checked;
            }

            function updateVolumeUI() {
                volumeLevel = volumeControl.value / 100;
                volumeValue.textContent = volumeControl.value + '%';

                // Estiliza a barra de volume principal
                const percentage = volumeControl.value;
                volumeControl.style.background = `linear-gradient(to right, #667eea 0%, #667eea ${percentage}%, #2d3139 ${percentage}%, #2d3139 100%)`;

                // Atualiza o slider compacto
                if (volumeCompact) {
                    volumeCompact.style.background = `linear-gradient(to right, #667eea 0%, #667eea ${percentage}%, #2d3139 ${percentage}%, #2d3139 100%)`;
                }
            }

            // Adiciona interatividade ao slider compacto
            if (volumeCompact) {
                volumeCompact.addEventListener('click', function(e) {
                    const rect = volumeCompact.getBoundingClientRect();
                    const x = e.clientX - rect.left;
                    const width = rect.width;
                    const percentage = Math.round((x / width) * 100);

                    volumeControl.value = Math.max(0, Math.min(100, percentage));
                    updateVolumeUI();
                });

                volumeCompact.style.cursor = 'pointer';
            }

            soundToggle.addEventListener('change', updateToggleUI);
            volumeControl.addEventListener('input', updateVolumeUI);

            // Estado inicial
            updateToggleUI();
            updateVolumeUI();

            // Customiza o cursor do slider
            volumeControl.style.cursor = 'pointer';
        });
        
        // Switch entre abas
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            const chartContainer = document.getElementById('chart-container');
            const openOps = document.getElementById('open-operations');
            const closedOps = document.getElementById('closed-operations');

            if (tab === 'chart') {
                chartContainer.style.display = 'block';
                openOps.style.display = 'none';
                closedOps.style.display = 'none';

                // For√ßa recarregamento do gr√°fico ao voltar para aba
                if (!priceChart || priceChart._destroyed) {
                    console.log('Carregando gr√°fico (primeira vez)');
                    loadChart();
                } else {
                    // Tenta redesenhar o gr√°fico existente
                    try {
                        console.log('Redesenhando gr√°fico existente');
                        priceChart.timeScale().fitContent();
                        // For√ßa atualiza√ß√£o do tamanho
                        const chartEl = document.getElementById('priceChart');
                        if (chartEl) {
                            priceChart.applyOptions({ width: chartEl.offsetWidth });
                        }
                    } catch (error) {
                        console.log('Erro ao redesenhar, recarregando:', error);
                        priceChart = null;
                        loadChart();
                    }
                }
            } else if (tab === 'open') {
                chartContainer.style.display = 'none';
                openOps.style.display = 'flex';
                closedOps.style.display = 'none';
            } else {
                chartContainer.style.display = 'none';
                openOps.style.display = 'none';
                closedOps.style.display = 'flex';
            }
        }
        
        // Carrega gr√°fico de candles
        async function loadChart() {
            try {
                const symbol = document.getElementById('symbol').value;
                console.log('Carregando gr√°fico para:', symbol);
                const response = await fetch(`/api/chart/${encodeURIComponent(symbol)}`);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                console.log('Dados recebidos:', data);

                if (data.error) {
                    console.error('Erro do servidor:', data.error);
                    return;
                }

                if (data.candles && data.candles.length > 0) {
                    console.log(`Desenhando ${data.candles.length} candles`);
                    drawChart(data.candles, data.ema_short, data.ema_mid, false); // false = n√£o for√ßar fit
                } else {
                    console.warn('Nenhum candle recebido');
                }
            } catch (error) {
                console.error('Erro ao carregar gr√°fico:', error);
            }
        }
        
        // Desenha gr√°fico de candles REAL
        function drawChart(candles, ema_short, ema_mid, forceFit = true) {
            console.log('Desenhando gr√°fico...', candles.length, 'candles');

            const chartEl = document.getElementById('priceChart');
            if (!chartEl) {
                console.error('Elemento #priceChart n√£o encontrado');
                return;
            }

            // Salva estado atual do gr√°fico se existir
            let savedPosition = null;
            if (priceChart && !forceFit) {
                try {
                    savedPosition = {
                        timeScale: priceChart.timeScale().getVisibleLogicalRange(),
                        scrollPosition: priceChart.timeScale().getScrollPosition()
                    };
                    console.log('Posi√ß√£o do gr√°fico salva:', savedPosition);
                } catch (error) {
                    console.log('N√£o foi poss√≠vel salvar posi√ß√£o:', error);
                }
            }

            // Destr√≥i gr√°fico anterior se existir
            if (priceChart && typeof priceChart.remove === 'function') {
                try {
                    priceChart.remove();
                    console.log('Gr√°fico anterior destru√≠do');
                } catch (error) {
                    console.log('Erro ao destruir gr√°fico anterior:', error);
                }
            }
            priceChart = null;

            // Verifica se LightweightCharts est√° dispon√≠vel
            if (typeof LightweightCharts === 'undefined') {
                console.error('LightweightCharts n√£o carregado!');
                // Fallback: mostra dados em texto
                let html = '<div style="color: white; padding: 20px;">';
                html += '<h3>Last 10 Candles:</h3>';
                candles.slice(-10).forEach((c, i) => {
                    const date = new Date(c.timestamp).toLocaleTimeString();
                    const color = c.close >= c.open ? 'lime' : 'red';
                    html += `<div style="color: ${color};">${date} - O:${c.open} H:${c.high} L:${c.low} C:${c.close}</div>`;
                });
                html += '</div>';
                chartEl.innerHTML = html;
                return;
            }

            // Limpa canvas completamente
            chartEl.innerHTML = '';
            chartEl.style.width = '100%';
            chartEl.style.height = '500px';

            // Cria o gr√°fico
            const chart = LightweightCharts.createChart(chartEl, {
                layout: {
                    background: { color: '#0f1419' },
                    textColor: '#e4e6eb',
                },
                grid: {
                    vertLines: { color: '#2d3139' },
                    horzLines: { color: '#2d3139' },
                },
                width: chartEl.offsetWidth,
                height: 500,
                timeScale: {
                    timeVisible: true,
                    secondsVisible: false,
                    lockVisibleTimeRangeOnResize: true,  // Importante: trava a vis√£o ao redimensionar
                },
            });
            
            // Verifica se addCandlestickSeries existe
            if (typeof chart.addCandlestickSeries !== 'function') {
                console.error('addCandlestickSeries n√£o dispon√≠vel nesta vers√£o');
                chartEl.innerHTML = '<div style="color: white; padding: 20px;"><p>Vers√£o antiga da biblioteca. Atualizando...</p></div>';
                location.reload();
                return;
            }
            
            // Prepara dados de candles
            const candleSeries = chart.addCandlestickSeries({
                upColor: '#38ef7d',
                downColor: '#f5576c',
                borderVisible: true,
                wickUpColor: '#38ef7d',
                wickDownColor: '#f5576c',
            });
            
            const candleData = candles.map(c => ({
                time: c.timestamp / 1000,
                open: c.open,
                high: c.high,
                low: c.low,
                close: c.close,
            }));
            
            console.log('Dados candles:', candleData.slice(0, 3));
            candleSeries.setData(candleData);
            
            // Adiciona EMA 8
            const emaShortSeries = chart.addLineSeries({
                color: '#f9b53a',
                lineWidth: 2,
                title: 'EMA 8',
            });
            
            const emaShortData = candles.map((c, i) => ({
                time: c.timestamp / 1000,
                value: ema_short[i] || c.close,
            }));
            
            emaShortSeries.setData(emaShortData);
            
            // Adiciona EMA 21
            const emaMidSeries = chart.addLineSeries({
                color: '#667eea',
                lineWidth: 2,
                title: 'EMA 21',
            });
            
            const emaMidData = candles.map((c, i) => ({
                time: c.timestamp / 1000,
                value: ema_mid[i] || c.close,
            }));
            
            emaMidSeries.setData(emaMidData);
            
            // Atualiza tamanho quando a janela redimensiona
            window.addEventListener('resize', () => {
                chart.applyOptions({ width: chartEl.offsetWidth });
            });
            
            // Restaura posi√ß√£o salva ou ajusta para mostrar os √∫ltimos candles
            if (savedPosition && !forceFit) {
                try {
                    setTimeout(() => {
                        if (savedPosition.timeScale) {
                            chart.timeScale().setVisibleLogicalRange(savedPosition.timeScale);
                        }
                        if (savedPosition.scrollPosition) {
                            chart.timeScale().scrollToPosition(savedPosition.scrollPosition, false);
                        }
                        console.log('Posi√ß√£o do gr√°fico restaurada');
                    }, 100);
                } catch (error) {
                    console.log('Erro ao restaurar posi√ß√£o, usando fitContent:', error);
                    chart.timeScale().fitContent();
                }
            } else {
                chart.timeScale().fitContent();
            }

            priceChart = chart;
        }
        
        // Carrega configura√ß√£o ao iniciar
        async function loadConfig() {
            try {
                const response = await fetch('/api/config');
                const config = await response.json();

                document.getElementById('symbol').value = config.SYMBOL || 'BTC/USDT';
                document.getElementById('timeframe').value = config.TIMEFRAME || '5m';
                document.getElementById('positionSize').value = config.POSITION_SIZE_USD || 50;
                document.getElementById('leverage').value = config.LEVERAGE || 10;
                document.getElementById('useDemo').value = (config.USE_DEMO === true || config.USE_DEMO === 'true') ? 'true' : 'false';

                // Carrega configura√ß√µes de filtros de entrada
                document.getElementById('rsiLong').value = config.RSI_LONG || 55;
                document.getElementById('rsiShort').value = config.RSI_SHORT || 40;
                document.getElementById('useVol').checked = config.USE_VOL === true;
                document.getElementById('useAdx').checked = config.USE_ADX === true;
                document.getElementById('adxThresh').value = config.ADX_THRESH || 18;

                // Carrega configura√ß√µes de sa√≠da
                document.getElementById('stopLoss').value = (config.STOP_LOSS * 100) || 0.8;
                document.getElementById('takeProfit').value = (config.TAKE_PROFIT * 100) || 1.8;
                document.getElementById('trailingStop').value = (config.TRAILING_STOP * 100) || 0.5;
                document.getElementById('useFixedExit').checked = config.USE_FIXED_EXIT !== false;
                document.getElementById('useTrailing').checked = config.USE_TRAILING !== false;

                // Filtros de sa√≠da RSI
                document.getElementById('useExitRsi').checked = config.USE_EXIT_RSI === true;
                document.getElementById('exitRsiLong').value = config.EXIT_RSI_LONG || 70;
                document.getElementById('exitRsiShort').value = config.EXIT_RSI_SHORT || 30;

                // Filtros de sa√≠da ADX
                document.getElementById('useExitAdx').checked = config.USE_EXIT_ADX === true;
                document.getElementById('exitAdxThreshold').value = config.EXIT_ADX_THRESHOLD || 25;

                // Filtro temporal
                document.getElementById('useTimeExit').checked = config.USE_TIME_EXIT === true;
                document.getElementById('exitAfterMinutes').value = config.EXIT_AFTER_MINUTES || 60;

                // Filtro de volume
                document.getElementById('exitOnVolumeSpike').checked = config.EXIT_ON_VOLUME_SPIKE !== false;
                document.getElementById('exitVolumeMultiplier').value = config.EXIT_VOLUME_MULTIPLIER || 2.0;

                // Atualiza display de filtros ativos
                updateActiveFilters(config);

                // Atualiza summaries do modal
                updateConfigSummaries();

                // Atualiza sidebar com informa√ß√µes do bot
                updateSidebarStatus(config);

                // Atualiza header
                document.getElementById('currentSymbol').textContent = config.SYMBOL || 'BTC/USDT';

                // Mostra/oculta modo Demo
                updateDemoUI();

                // Carrega dados
                loadLogs();
                loadPrice();
                loadOperations();
                loadPnl();

                // Carrega gr√°fico
                loadChart();
            } catch (error) {
                showAlert('Error loading configuration', 'error');
            }
        }
        
        // Atualiza UI do modo Demo
        function updateDemoUI() {
            const isDemo = document.getElementById('useDemo').value === 'true';
            const demoWarning = document.getElementById('demoWarning');
            const demoBalanceContainer = document.getElementById('demoBalanceContainer');
            
            if (isDemo) {
                demoWarning.style.display = 'block';
                demoBalanceContainer.style.display = 'block';
                loadDemoBalance();
            } else {
                demoWarning.style.display = 'none';
                demoBalanceContainer.style.display = 'none';
            }
        }
        
        // Carrega saldo Demo
        async function loadDemoBalance() {
            try {
                const response = await fetch('/api/demo-balance');
                const data = await response.json();
                if (data.balance !== undefined) {
                    document.getElementById('demoBalance').textContent = '$' + data.balance.toFixed(2);
                }
            } catch (error) {
                console.error('Erro ao carregar saldo demo:', error);
            }
        }
        
        // Listener para mudan√ßa de modo
        document.getElementById('useDemo').addEventListener('change', function() {
            updateDemoUI();
        });
        
        // Fun√ß√µes do Modal de Config
        function openConfigModal() {
            document.getElementById('configModal').style.display = 'block';
            updateConfigSummaries();
        }

        function closeConfigModal() {
            document.getElementById('configModal').style.display = 'none';
        }

        // Alterna entre abas de configura√ß√£o
        function switchConfigTab(tab) {
            // Remove classe active de todas as abas
            document.querySelectorAll('.config-tab').forEach(t => {
                t.classList.remove('active');
                t.style.color = '#8d8f94';
                t.style.borderBottom = '2px solid transparent';
            });

            // Remove display de todos os conte√∫dos
            document.querySelectorAll('.config-tab-content').forEach(content => {
                content.style.display = 'none';
            });

            // Adiciona classe active na aba selecionada
            const activeTab = document.querySelector(`.config-tab[onclick="switchConfigTab('${tab}')"]`);
            activeTab.classList.add('active');
            activeTab.style.color = '#667eea';
            activeTab.style.borderBottom = '2px solid #667eea';

            // Mostra conte√∫do correspondente
            const contentId = tab === 'entry' ? 'entryFiltersTab' : 'exitFiltersTab';
            document.getElementById(contentId).style.display = 'block';
        }

        // Atualiza os summaries dinamicamente
        function updateConfigSummaries() {
            // Entry Summary
            document.getElementById('summaryRsiLong').textContent = document.getElementById('rsiLong').value;
            document.getElementById('summaryRsiShort').textContent = document.getElementById('rsiShort').value;
            document.getElementById('summaryVol').textContent = document.getElementById('useVol').checked ? 'Enabled' : 'Disabled';
            document.getElementById('summaryAdx').textContent = document.getElementById('useAdx').checked ? 'Enabled' : 'Disabled';
            document.getElementById('summaryAdxThresh').textContent = document.getElementById('adxThresh').value;

            // Exit Summary
            document.getElementById('summaryStopLoss').textContent = document.getElementById('stopLoss').value;
            document.getElementById('summaryTakeProfit').textContent = document.getElementById('takeProfit').value;
            document.getElementById('summaryTrailing').textContent = document.getElementById('useTrailing').checked ? 'Enabled' : 'Disabled';
            document.getElementById('summaryTrailingValue').textContent = document.getElementById('trailingStop').value;
            document.getElementById('summaryExitRsi').textContent = document.getElementById('useExitRsi').checked ? 'Enabled' : 'Disabled';
            document.getElementById('summaryExitAdx').textContent = document.getElementById('useExitAdx').checked ? 'Enabled' : 'Disabled';
            document.getElementById('summaryTimeExit').textContent = document.getElementById('useTimeExit').checked ? 'Enabled' : 'Disabled';
            document.getElementById('summaryVolSpike').textContent = document.getElementById('exitOnVolumeSpike').checked ? 'Enabled' : 'Disabled';
            document.getElementById('summaryVolSpikeValue').textContent = document.getElementById('exitVolumeMultiplier').value;

            // Atualiza textos dos RSI Exit se habilitado
            if (document.getElementById('useExitRsi').checked) {
                const rsiLongValue = document.getElementById('exitRsiLong').value;
                const rsiShortValue = document.getElementById('exitRsiShort').value;
                document.getElementById('summaryExitRsi').textContent = `L‚â•${rsiLongValue} S‚â§${rsiShortValue}`;
            }

            // Atualiza texto do ADX Exit se habilitado
            if (document.getElementById('useExitAdx').checked) {
                const adxValue = document.getElementById('exitAdxThreshold').value;
                document.getElementById('summaryExitAdx').textContent = `Enabled (<${adxValue})`;
            }

            // Atualiza texto do Time Exit se habilitado
            if (document.getElementById('useTimeExit').checked) {
                const timeValue = document.getElementById('exitAfterMinutes').value;
                document.getElementById('summaryTimeExit').textContent = `Enabled (${timeValue}min)`;
            }
        }

        // Adiciona listeners para atualizar summaries em tempo real
        document.addEventListener('DOMContentLoaded', function() {
            // Entry filters
            ['rsiLong', 'rsiShort', 'useVol', 'useAdx', 'adxThresh'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', updateConfigSummaries);
                    element.addEventListener('change', updateConfigSummaries);
                }
            });

            // Exit filters
            ['stopLoss', 'takeProfit', 'trailingStop', 'useFixedExit', 'useTrailing',
             'useExitRsi', 'exitRsiLong', 'exitRsiShort', 'useExitAdx', 'exitAdxThreshold',
             'useTimeExit', 'exitAfterMinutes', 'exitOnVolumeSpike', 'exitVolumeMultiplier'].forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', updateConfigSummaries);
                    element.addEventListener('change', updateConfigSummaries);
                }
            });
        });

        // Fun√ß√µes do Modal de Ajuda
        function openHelpModal() {
            document.getElementById('helpModal').style.display = 'block';
        }

        function closeHelpModal() {
            document.getElementById('helpModal').style.display = 'none';
        }

        // Fecha modal ao clicar fora
        window.onclick = function(event) {
            const configModal = document.getElementById('configModal');
            const helpModal = document.getElementById('helpModal');

            if (event.target == configModal) {
                closeConfigModal();
            }
            if (event.target == helpModal) {
                closeHelpModal();
            }
        }
        
        async function saveFiltersConfig() {
            await saveConfig();
            showAlert('‚úì Filters saved successfully!', 'success');
            closeConfigModal();
            
            // Recarrega config para atualizar filtros ativos
            const response = await fetch('/api/config');
            const config = await response.json();
            updateActiveFilters(config);
        }
        
        // Atualiza display de filtros ativos no header
        function updateActiveFilters(config) {
            const filtersContainer = document.getElementById('activeFilters');
            filtersContainer.innerHTML = '';

            // Filtros obrigat√≥rios de entrada (sempre ativos)
            const emaBadge = document.createElement('div');
            emaBadge.className = 'filter-badge required';
            emaBadge.textContent = '‚úì EMA Crossover';
            filtersContainer.appendChild(emaBadge);

            const rsiBadge = document.createElement('div');
            rsiBadge.className = 'filter-badge required';
            rsiBadge.textContent = `RSI IN: L>${config.RSI_LONG || 55} S<${config.RSI_SHORT || 40}`;
            filtersContainer.appendChild(rsiBadge);

            // Filtros opcionais de entrada (se ativados)
            if (config.USE_VOL === true) {
                const volBadge = document.createElement('div');
                volBadge.className = 'filter-badge optional';
                volBadge.textContent = '‚úì Vol 15%';
                filtersContainer.appendChild(volBadge);
            }

            if (config.USE_ADX === true) {
                const adxBadge = document.createElement('div');
                adxBadge.className = 'filter-badge optional';
                adxBadge.textContent = `‚úì ADX>${config.ADX_THRESH || 18}`;
                filtersContainer.appendChild(adxBadge);
            }

            // Filtros de sa√≠da (sempre mostrar stop loss e take profit)
            const stopLossBadge = document.createElement('div');
            stopLossBadge.className = 'filter-badge required';
            stopLossBadge.style.backgroundColor = 'rgba(245, 87, 108, 0.2)';
            stopLossBadge.style.borderColor = '#f5576c';
            stopLossBadge.style.color = '#f5576c';
            stopLossBadge.textContent = `SL ${(config.STOP_LOSS * 100).toFixed(1)}%`;
            filtersContainer.appendChild(stopLossBadge);

            const takeProfitBadge = document.createElement('div');
            takeProfitBadge.className = 'filter-badge required';
            takeProfitBadge.style.backgroundColor = 'rgba(56, 239, 125, 0.2)';
            takeProfitBadge.style.borderColor = '#38ef7d';
            takeProfitBadge.style.color = '#38ef7d';
            takeProfitBadge.textContent = `TP ${(config.TAKE_PROFIT * 100).toFixed(1)}%`;
            filtersContainer.appendChild(takeProfitBadge);

            // Filtros de sa√≠da opcionais
            if (config.USE_EXIT_RSI === true) {
                const exitRsiBadge = document.createElement('div');
                exitRsiBadge.className = 'filter-badge optional';
                exitRsiBadge.style.backgroundColor = 'rgba(249, 181, 58, 0.2)';
                exitRsiBadge.style.borderColor = '#f9b53a';
                exitRsiBadge.style.color = '#f9b53a';
                exitRsiBadge.textContent = `RSI OUT: L‚â•${config.EXIT_RSI_LONG || 70} S‚â§${config.EXIT_RSI_SHORT || 30}`;
                filtersContainer.appendChild(exitRsiBadge);
            }

            if (config.USE_EXIT_ADX === true) {
                const exitAdxBadge = document.createElement('div');
                exitAdxBadge.className = 'filter-badge optional';
                exitAdxBadge.style.backgroundColor = 'rgba(249, 181, 58, 0.2)';
                exitAdxBadge.style.borderColor = '#f9b53a';
                exitAdxBadge.style.color = '#f9b53a';
                exitAdxBadge.textContent = `ADX OUT<${config.EXIT_ADX_THRESHOLD || 25}`;
                filtersContainer.appendChild(exitAdxBadge);
            }

            if (config.USE_TIME_EXIT === true) {
                const timeBadge = document.createElement('div');
                timeBadge.className = 'filter-badge optional';
                timeBadge.style.backgroundColor = 'rgba(249, 181, 58, 0.2)';
                timeBadge.style.borderColor = '#f9b53a';
                timeBadge.style.color = '#f9b53a';
                timeBadge.textContent = `‚è∞ ${config.EXIT_AFTER_MINUTES || 60}min`;
                filtersContainer.appendChild(timeBadge);
            }

            if (config.EXIT_ON_VOLUME_SPIKE !== false) {
                const volSpikeBadge = document.createElement('div');
                volSpikeBadge.className = 'filter-badge optional';
                volSpikeBadge.style.backgroundColor = 'rgba(249, 181, 58, 0.2)';
                volSpikeBadge.style.borderColor = '#f9b53a';
                volSpikeBadge.style.color = '#f9b53a';
                volSpikeBadge.textContent = `üìä Vol Spike ${config.EXIT_VOLUME_MULTIPLIER || 2.0}x`;
                filtersContainer.appendChild(volSpikeBadge);
            }

            if (config.USE_TRAILING !== false) {
                const trailBadge = document.createElement('div');
                trailBadge.className = 'filter-badge optional';
                trailBadge.style.backgroundColor = 'rgba(102, 126, 234, 0.2)';
                trailBadge.style.borderColor = '#667eea';
                trailBadge.style.color = '#667eea';
                trailBadge.textContent = `üéØ Trail ${(config.TRAILING_STOP * 100).toFixed(1)}%`;
                filtersContainer.appendChild(trailBadge);
            }
        }

        // Atualiza sidebar com informa√ß√µes de status
        function updateSidebarStatus(config) {
            // Atualiza informa√ß√µes do bot no sidebar
            const sidebarStatus = document.getElementById('sidebarStatus');
            const sidebarSymbol = document.getElementById('sidebarSymbol');
            const sidebarTimeframe = document.getElementById('sidebarTimeframe');

            if (sidebarSymbol) sidebarSymbol.textContent = config.SYMBOL || 'BTC/USDT';
            if (sidebarTimeframe) sidebarTimeframe.textContent = config.TIMEFRAME || '5m';
        }

        // Atualiza pre√ßo no sidebar
        function updateSidebarPrice(priceData) {
            const sidebarPrice = document.getElementById('sidebarPrice');
            const sidebarPriceChange = document.getElementById('sidebarPriceChange');

            if (sidebarPrice && priceData.price) {
                sidebarPrice.textContent = `$${parseFloat(priceData.price).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            }

            if (sidebarPriceChange && priceData.change24h) {
                const changePercent = parseFloat(priceData.change24h);
                const changeText = changePercent >= 0 ? `+${changePercent.toFixed(2)}%` : `${changePercent.toFixed(2)}%`;
                const changeColor = changePercent >= 0 ? '#38ef7d' : '#f5576c';
                sidebarPriceChange.textContent = changeText;
                sidebarPriceChange.style.color = changeColor;
            }
        }

        // Atualiza PnL no sidebar
        function updateSidebarPnl(pnlData) {
            const sidebarPnl = document.getElementById('sidebarPnl');

            if (sidebarPnl && pnlData) {
                const pnlValue = parseFloat(pnlData.pnl || 0);
                const pnlText = pnlValue >= 0 ? `+$${pnlValue.toFixed(2)}` : `-$${Math.abs(pnlValue).toFixed(2)}`;

                sidebarPnl.textContent = pnlText;
                sidebarPnl.className = pnlValue >= 0 ? 'pnl-display positive' : 'pnl-display negative';
            }
        }
        
        // Salva configura√ß√£o
        async function saveConfig() {
            try {
                const config = {
                    SYMBOL: document.getElementById('symbol').value,
                    TIMEFRAME: document.getElementById('timeframe').value,
                    POSITION_SIZE_USD: parseFloat(document.getElementById('positionSize').value),
                    LEVERAGE: parseInt(document.getElementById('leverage').value),
                    USE_DEMO: document.getElementById('useDemo').value === 'true',
                    RSI_LONG: parseInt(document.getElementById('rsiLong').value),
                    RSI_SHORT: parseInt(document.getElementById('rsiShort').value),
                    USE_VOL: document.getElementById('useVol').checked,
                    USE_ADX: document.getElementById('useAdx').checked,
                    ADX_THRESH: parseInt(document.getElementById('adxThresh').value),

                    // Configura√ß√µes de sa√≠da
                    STOP_LOSS: parseFloat(document.getElementById('stopLoss').value) / 100,
                    TAKE_PROFIT: parseFloat(document.getElementById('takeProfit').value) / 100,
                    TRAILING_STOP: parseFloat(document.getElementById('trailingStop').value) / 100,
                    USE_FIXED_EXIT: document.getElementById('useFixedExit').checked,
                    USE_TRAILING: document.getElementById('useTrailing').checked,

                    // Filtros de sa√≠da RSI
                    USE_EXIT_RSI: document.getElementById('useExitRsi').checked,
                    EXIT_RSI_LONG: parseInt(document.getElementById('exitRsiLong').value),
                    EXIT_RSI_SHORT: parseInt(document.getElementById('exitRsiShort').value),

                    // Filtros de sa√≠da ADX
                    USE_EXIT_ADX: document.getElementById('useExitAdx').checked,
                    EXIT_ADX_THRESHOLD: parseInt(document.getElementById('exitAdxThreshold').value),

                    // Filtro temporal
                    USE_TIME_EXIT: document.getElementById('useTimeExit').checked,
                    EXIT_AFTER_MINUTES: parseInt(document.getElementById('exitAfterMinutes').value),

                    // Filtro de volume
                    EXIT_ON_VOLUME_SPIKE: document.getElementById('exitOnVolumeSpike').checked,
                    EXIT_VOLUME_MULTIPLIER: parseFloat(document.getElementById('exitVolumeMultiplier').value)
                };

                const response = await fetch('/api/config', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(config)
                });

                const result = await response.json();

                if (result.success) {
                    showAlert('‚úì Configuration saved!', 'success');
                    document.getElementById('currentSymbol').textContent = config.SYMBOL;
                    updateDemoUI();
                } else {
                    showAlert('Error: ' + result.message, 'error');
                }
            } catch (error) {
                showAlert('Error: ' + error.message, 'error');
            }
        }
        
        // Inicia o bot
        async function startBot() {
            await saveConfig();
            
            try {
                const response = await fetch('/api/start-bot', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert('‚úì Bot started successfully!', 'success');
                } else {
                    showAlert('Error: ' + result.message, 'error');
                }
            } catch (error) {
                showAlert('Error starting bot: ' + error.message, 'error');
            }
        }
        
        // Para o bot
        async function stopBot() {
            try {
                const response = await fetch('/api/stop-bot', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'}
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert('‚úì Bot stopped successfully!', 'success');
                } else {
                    showAlert('Error: ' + result.message, 'error');
                }
            } catch (error) {
                showAlert('Error stopping bot: ' + error.message, 'error');
            }
        }
        
        // Mostra alerta
        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            alert.className = 'alert ' + type;
            alert.textContent = message;
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }
        
        // Carrega logs do arquivo
        async function loadLogs() {
            try {
                const response = await fetch('/api/logs');
                const data = await response.json();

                if (data.logs) {
                    const container = document.getElementById('logsContainer');
                    container.innerHTML = '';

                    // Conta opera√ß√µes de entrada nos logs
                    let currentTradeCount = 0;
                    const recentLogs = data.logs.slice(-50);

                    recentLogs.forEach(log => {
                        const entry = document.createElement('div');
                        entry.className = 'log-entry ' + (log.type || 'info');
                        entry.textContent = log.message;
                        container.appendChild(entry);

                        // Conta apenas opera√ß√µes de entrada (LONG/SHORT)
                        if (log.type === 'entry-long' || log.type === 'entry-short') {
                            currentTradeCount++;
                        }
                    });

                    // Toca som apenas se detectou NOVA opera√ß√£o de entrada
                    if (soundEnabled && currentTradeCount > lastTradeCount) {
                        // Encontra a √∫ltima opera√ß√£o para determinar o tipo
                        for (let i = recentLogs.length - 1; i >= 0; i--) {
                            const log = recentLogs[i];
                            if (log.type === 'entry-long') {
                                playTradeSound('LONG');
                                break;
                            } else if (log.type === 'entry-short') {
                                playTradeSound('SHORT');
                                break;
                            }
                        }

                        // Atualiza o contador
                        lastTradeCount = currentTradeCount;
                    }

                    // Auto-scroll para o final
                    container.scrollTop = container.scrollHeight;
                }
            } catch (error) {
                console.error('Erro ao carregar logs:', error);
            }
        }
        
        // Limpa os logs
        async function clearLogs() {
            if (!confirm('Are you sure you want to clear all logs?')) {
                return;
            }

            try {
                const response = await fetch('/api/clear-logs', {
                    method: 'POST'
                });

                const result = await response.json();

                if (result.success) {
                    showAlert('‚úì Logs cleared successfully!', 'success');
                    // Reseta o contador de opera√ß√µes ao limpar logs
                    lastTradeCount = 0;
                    loadLogs();
                } else {
                    showAlert('Error: ' + result.message, 'error');
                }
            } catch (error) {
                showAlert('Error clearing logs: ' + error.message, 'error');
            }
        }
        
        // Reseta saldo Demo
        async function resetDemo() {
            if (!confirm('Are you sure you want to reset the demo balance?')) {
                return;
            }
            
            try {
                const response = await fetch('/api/reset-demo', {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showAlert(result.message, 'success');
                    loadDemoBalance();
                } else {
                    showAlert('Error: ' + result.message, 'error');
                }
            } catch (error) {
                showAlert('Error resetting balance: ' + error.message, 'error');
            }
        }
        
        // Carrega opera√ß√µes
        async function loadOperations() {
            try {
                const response = await fetch('/api/operations');
                const data = await response.json();
                
                // Opera√ß√µes abertas
                const openContainer = document.getElementById('open-operations');
                openContainer.innerHTML = '';
                
                if (data.open_operations && data.open_operations.length > 0) {
                    data.open_operations.forEach(op => {
                        const card = createOperationCard(op, false);
                        openContainer.appendChild(card);
                    });
                } else {
                    openContainer.innerHTML = '<div class="empty-state"><p>No open operations</p></div>';
                }
                
                // Opera√ß√µes fechadas
                const closedContainer = document.getElementById('closed-operations');
                closedContainer.innerHTML = '';
                
                if (data.closed_operations && data.closed_operations.length > 0) {
                    data.closed_operations.forEach(op => {
                        const card = createOperationCard(op, true);
                        closedContainer.appendChild(card);
                    });
                } else {
                    closedContainer.innerHTML = '<div class="empty-state"><p>No closed operations</p></div>';
                }
            } catch (error) {
                console.error('Erro ao carregar opera√ß√µes:', error);
            }
        }
        
        // Cria card de opera√ß√£o
        function createOperationCard(op, isClosed) {
            const card = document.createElement('div');
            card.className = 'operation-card';
            
            const pnlClass = op.pnl >= 0 ? 'pnl-positive' : 'pnl-negative';
            const pnlSign = op.pnl >= 0 ? '+' : '';
            
            if (isClosed) {
                card.innerHTML = `
                    <div class="operation-info">
                        <div class="operation-title">${op.side} ${op.symbol}</div>
                        <div class="operation-details">Price: $${op.entry_price.toFixed(2)} ‚Üí $${op.exit_price.toFixed(2)} | Qty: ${op.quantity.toFixed(6)} | Leverage: ${op.leverage}x</div>
                        <div class="operation-details">Entry: ${op.entry_time} | Exit: ${op.exit_time} (${op.duration})</div>
                    </div>
                    <div class="operation-pnl ${pnlClass}">${pnlSign}$${Math.abs(op.pnl).toFixed(2)}</div>
                `;
            } else {
                card.innerHTML = `
                    <div class="operation-info">
                        <div class="operation-title">${op.side} ${op.symbol}</div>
                        <div class="operation-details">Price: $${op.current_price.toFixed(2)} | Qty: ${op.quantity.toFixed(6)} | Leverage: ${op.leverage}x</div>
                        <div class="operation-details">Entry: ${op.entry_time} | ROI: ${pnlSign}${op.pnl_percent.toFixed(2)}%</div>
                    </div>
                    <div class="operation-pnl ${pnlClass}">${pnlSign}$${Math.abs(op.pnl).toFixed(2)}</div>
                `;
            }
            
            return card;
        }
        
        // Busca pre√ßo real da Binance
        async function loadPrice() {
            const symbol = document.getElementById('symbol').value;
            
            try {
                const encodedSymbol = encodeURIComponent(symbol);
                const response = await fetch(`/api/price/${encodedSymbol}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.price && data.price > 0) {
                    const priceFormatted = data.price.toLocaleString('pt-BR', {
                        minimumFractionDigits: 2,
                        maximumFractionDigits: 2
                    });
                    document.getElementById('currentPrice').textContent = '$' + priceFormatted;

                    const changeSign = data.change_24h >= 0 ? '+' : '';
                    const changeColor = data.change_24h >= 0 ? '#38ef7d' : '#f5576c';
                    document.getElementById('priceChange').textContent = `24h: ${changeSign}${data.change_24h.toFixed(2)}%`;
                    document.getElementById('priceChange').style.color = changeColor;

                    // Atualiza sidebar com pre√ßo
                    updateSidebarPrice({
                        price: data.price,
                        change24h: data.change_24h
                    });
                } else if (data.error) {
                    console.error('Erro na API:', data.error);
                    document.getElementById('currentPrice').textContent = 'Error';
                    document.getElementById('priceChange').textContent = 'N/A';
                }
            } catch (error) {
                console.error('Erro ao carregar pre√ßo:', error);
                document.getElementById('currentPrice').textContent = 'Error';
                document.getElementById('priceChange').textContent = 'N/A';
            }
        }
        
        // Carrega PnL total
        async function loadPnl() {
            try {
                const response = await fetch('/api/pnl');
                const data = await response.json();

                if (data.error) {
                    console.error('Erro no PnL:', data.error);
                    return;
                }

                const pnlDisplay = document.getElementById('pnlDisplay');
                const pnlOps = document.getElementById('pnlOps');
                const pnlWinRate = document.getElementById('pnlWinRate');
                const pnlStatus = document.getElementById('pnlStatus');

                // PnL total (abertas + fechadas)
                const totalPnl = data.all_pnl || 0;
                const pnlSign = totalPnl >= 0 ? '+' : '';

                // Formata o valor
                const pnlFormatted = `${pnlSign}$${Math.abs(totalPnl).toFixed(2)}`;
                pnlDisplay.textContent = pnlFormatted;

                // Aplica cor baseada no resultado
                pnlDisplay.className = 'pnl-display ' + (totalPnl >= 0 ? 'pnl-positive' : 'pnl-negative');

                // Atualiza PnL no sidebar
                updateSidebarPnl({
                    pnl: totalPnl
                });

                // Estat√≠sticas
                const totalOps = data.total_operations || 0;
                const winRate = data.win_rate || 0;

                if (totalOps > 0) {
                    pnlOps.textContent = `${totalOps} ops`;
                    pnlWinRate.textContent = `${winRate}%`;
                    pnlWinRate.style.color = winRate >= 50 ? '#38ef7d' : '#f5576c';

                    // Status descritivo
                    if (totalPnl > 0) {
                        pnlStatus.textContent = 'Lucrando';
                        pnlStatus.style.color = '#38ef7d';
                    } else if (totalPnl < 0) {
                        pnlStatus.textContent = 'Preju√≠zo';
                        pnlStatus.style.color = '#f5576c';
                    } else {
                        pnlStatus.textContent = 'Neutro';
                        pnlStatus.style.color = '#8d8f94';
                    }
                } else {
                    pnlOps.textContent = '0 ops';
                    pnlWinRate.textContent = '0%';
                    pnlStatus.textContent = 'Sem Ops';
                    pnlStatus.style.color = '#8d8f94';
                }

                // Adiciona informa√ß√µes detalhadas no tooltip
                if (data.demo_balance !== null) {
                    const balanceFormatted = data.demo_balance.toFixed(2);
                    const profitMargin = ((data.demo_balance - 1000) / 1000 * 100).toFixed(2);
                    pnlDisplay.title = `üìä Estat√≠sticas Detalhadas:\n` +
                        `üí∞ Saldo Demo: $${balanceFormatted}\n` +
                        `üìà Rentabilidade: ${profitMargin}%\n` +
                        `‚úÖ Opera√ß√µes Fechadas: $${data.total_pnl.toFixed(2)}\n` +
                        `üîÑ Opera√ß√µes Abertas: $${data.open_pnl.toFixed(2)}\n` +
                        `üéØ Total Ops: ${data.winning_ops + data.losing_ops}\n` +
                        `üèÜ Taxa de Acerto: ${winRate}%`;
                }

            } catch (error) {
                console.error('Erro ao carregar PnL:', error);
                document.getElementById('pnlDisplay').textContent = '$0.00';
                document.getElementById('pnlOps').textContent = '0 ops';
                document.getElementById('pnlWinRate').textContent = '0%';
                document.getElementById('pnlStatus').textContent = 'Erro';
                document.getElementById('pnlStatus').style.color = '#f5576c';
            }
        }

        // Carrega ao iniciar
        loadConfig();

        // Carrega gr√°fico periodicamente
        setInterval(async () => {
            const activeTab = document.querySelector('.tab.active');
            const chartTab = activeTab && activeTab.textContent.includes('Chart');

            if (chartTab) {
                console.log('Atualizando gr√°fico automaticamente...');
                try {
                    // Atualiza sem for√ßar fitContent para preservar posi√ß√£o/zoom
                    await loadChart();
                } catch (error) {
                    console.error('Erro na atualiza√ß√£o autom√°tica:', error);
                }
            }
        }, 30000); // Atualiza gr√°fico a cada 30s
        
        // Atualiza status e logs periodicamente
        setInterval(async () => {
            // Status
            try {
                const response = await fetch('/api/status');
                const status = await response.json();
                const statusBadges = document.querySelectorAll('.status-badge');
                
                statusBadges.forEach(badge => {
                    if (status.running) {
                        badge.className = 'status-badge status running';
                        badge.textContent = '‚óè Bot Running';
                    } else {
                        badge.className = 'status-badge status stopped';
                        badge.textContent = '‚óè Bot Stopped';
                    }
                });

                // Atualiza status no sidebar tamb√©m
                const sidebarStatus = document.getElementById('sidebarStatus');
                if (sidebarStatus) {
                    if (status.running) {
                        sidebarStatus.className = 'status-indicator running';
                        sidebarStatus.textContent = '‚óè Bot Running';
                    } else {
                        sidebarStatus.className = 'status-indicator stopped';
                        sidebarStatus.textContent = '‚óè Bot Stopped';
                    }
                }
            } catch (error) {
                console.error('Erro ao verificar status:', error);
            }
            
            // Logs
            loadLogs();
            
            // Pre√ßo
            loadPrice();

            // Opera√ß√µes
            loadOperations();

            // PnL
            loadPnl();

            // Saldo Demo (se ativo)
            if (document.getElementById('useDemo').value === 'true') {
                loadDemoBalance();
            }
        }, 5000);
    </script>
</body>
</html>

